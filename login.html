<!DOCTYPE html>
<html>

<head>
    <title>Login Page</title>
    <style>
        /* Style for the overlay */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }

        /* Style for the popup */
        .popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border: 1px solid #ccc;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body>
    {{if .InvalidLogin}}<div id="errorMessage" name="errorMessage" style="color:red;">{{.ErrorMessage}} </div>{{end}}




    {{if .UserName}}
    <p>Hello <b>{{.UserName}}</b>! <a href="/character">Make a character!</a>
    </p>
    {{end}}

    <form method="post" action="/login">
        {{if .UserName}}
        <input type="submit" name="Logout" value="Logout">
        {{else}}
        <input type="text" id="emailId" name="email" placeholder="{{if .UserEmail}}{{.UserEmail}}{{else}}Email{{end}}">
        <input type="password" id="PasswordId" name="password" placeholder="Password">
        <input type="submit" name="Login" value="Login">
        <button id="signupButton" type="button">Sign Up</button>
        {{if .NotVerified}}
        <button id="requestVerification" type="submit" formaction="/request-verification">Request Verification
            Email</button>
        {{end}}
        {{end}}
    </form>

    <!-- Create an overlay and popup for signup -->
    <div id="signupOverlay" class="overlay">
        <form id="signupPopup" class="popup" method="post" action="/login/signup">
            <h2>Sign Up</h2>
            <input type="text" id="signupEmail" name="signupEmail" placeholder="Email">
            <input type="password" id="signupPassword" name="signupPassword" placeholder="Password">
            <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm Password">
            <div id="passwordMismatch" style="color: red;"></div>
            <button id="signupSubmit">Submit</button>
        </form>
    </div>
    <script>
        // Show the signup popup when the signup button is clicked
        document.getElementById("signupButton").addEventListener("click", function () {
            document.getElementById("signupOverlay").style.display = "block";
        });

        // Close the signup popup when the user clicks outside of it
        window.addEventListener("mousedown", function (event) {
            const signupOverlay = document.getElementById("signupOverlay");
            if (event.target == signupOverlay) {
                signupOverlay.style.display = "none";
            }
        });

        document.getElementById("signupSubmit").addEventListener("click", function (event) {
            event.preventDefault();
            const signupEmail = document.getElementById("signupEmail").value;
            const signupPassword = document.getElementById("signupPassword").value;
            const confirmPassword = document.getElementById("confirmPassword").value;

            // Check if passwords match
            if (signupPassword !== confirmPassword) {
                document.getElementById("passwordMismatch").innerText = "Passwords do not match";
                return;
            } else {
                document.getElementById("passwordMismatch").innerText = "";
            }

            // Perform the signup request here

            const newUser = {
                email: signupEmail,
                password: signupPassword,
            };

            // Send the newUser object to your signup endpoint
            fetch('/login/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(newUser),
            })
                .then(response => {
                    // Check for 400 or 500 level responses
                    if (response.status >= 400) {
                        // Display error message in red text
                        return response.json().then(data => {
                            document.getElementById("passwordMismatch").innerText = data.error;
                            throw new Error(data.error);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    // Handle the response from the server here
                    console.log(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    </script>
</body>

</html>